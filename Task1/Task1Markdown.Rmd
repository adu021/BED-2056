---
title: ""
output: html_document
css: "CSS.css"
---
<center><img class="title" src="hotel.png" alt="N/A"></center>
<h1>NORWAY HOTELS<br>
STUDY</h1><br>

<body>
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

#Necessary libraries
library(lubridate)
library(tidyverse)
library(DataExplorer)

if(isTRUE(getOption('knitr.in.progress'))) { 
  counties <- read.csv("../Task1/95274.csv", header = TRUE, sep=";")
  country <- read.csv("../Task1/95276.csv", header = TRUE, sep=";")
} else {
  counties <- read.csv("Task1/95274.csv", header = TRUE, sep=";")
  country <- read.csv("Task1/95276.csv", header = TRUE, sep=";")
}
```

```{r, include=FALSE}
## Preparing the dataset for proper analysis

# Headers and content in English
names(counties) <- c("Region", "Date", "Statistic_Variable", "Percentage_Price")
names(country) <- c("Region", "Date", "Statistic_Variable", "Percentage_Price")
counties$Statistic_Variable <- recode(counties$Statistic_Variable, "Kapasitetsutnytting av senger (prosent)" = "Beds percentage capacity utilization", "Kapasitetsutnytting av rom (prosent)" = "Rooms percentage capacity utilization", "Pris per rom (kr)" = "Price per room (kr)")
country$Statistic_Variable <- recode(country$Statistic_Variable, "Kapasitetsutnytting av senger (prosent)" = "Beds percentage capacity utilization", "Kapasitetsutnytting av rom (prosent)" = "Rooms percentage capacity utilization", "Pris per rom (kr)" = "Price per room (kr)")

#Transforming the Date as a Date variable (had to go through the lubridate format because the as.Date function wouldn't want to work because it took the month variable for the date)
counties$Date <- gsub("M","-",counties$Date)
counties$Date <- parse_date_time(counties$Date, orders = "Ym")
counties$Date <- as.Date(counties$Date)
country$Date <- gsub("M","-",country$Date)
country$Date <- parse_date_time(country$Date, orders = "Ym")
country$Date <- as.Date(country$Date)

#Merging the two dataframes
whole <- bind_rows(counties, country)
```

<form><fieldset><h2>Comparing county and national average room price</h2><br>
```{r}
#Calculate the difference between county average room price
#and the national average room price per month
whole$Percentage_Price <- gsub(",", ".", whole$Percentage_Price)
whole$Percentage_Price <- as.numeric(whole$Percentage_Price)
widedf <- whole %>% tidyr::spread(Statistic_Variable, Percentage_Price)
names(widedf) <- c("Region", "Date", "RPCU", "BPCU", "PPR")
widedf$PPR <- as.numeric(widedf$PPR)
widedf %>% filter(widedf$PPR > 0 & widedf$Region != "0 Hele landet") -> meanCounty
meanCounty <- mean(meanCounty$PPR)
widedf %>% filter(widedf$PPR > 0 & widedf$Region == "0 Hele landet") -> meanCountry
meanCountry <- mean(meanCountry$PPR)
maindifference <- abs(meanCounty - meanCountry)
```

<p>The dataset allows us to calculate the county average room price per month, which corresponds to `r meanCounty` kr, and to compare it with the national average room price per month, of around `r meanCountry` kr.
Therefore, there is <b>a difference of `r maindifference` kr</b> between county average room price and the national average room price per month.</p>

```{r}
#What county (on average) has the highest positive and negative difference in price?
countyaverage <- widedf %>% filter(widedf$PPR > 0) %>% group_by(Region) %>% summarize(meanPPR = mean(PPR), difference = meanPPR - meanCountry) 
maxdif <- countyaverage %>% filter(countyaverage$difference == max(countyaverage$difference))
mindif <- countyaverage %>% filter(countyaverage$difference == min(countyaverage$difference))
```

<p>On average, the county that has the <b>highest positive difference is `r maxdif$Region`</b>, with a difference of `r maxdif$difference` kr.
On the contrary, the county with the <b>highest negative difference is `r mindif$Region`</b>, with a difference of `r mindif$difference` kr.</p>

```{r}
#Identify the year and county with the highest positive and negative difference.
countryyear <- widedf %>% mutate(Year = format(Date, "%Y")) %>% filter(widedf$Region == "0 Hele landet" & widedf$PPR != 0) %>% group_by(Year) %>% summarize(YearPPR = sum(PPR)) 
countryyear <- mean(countryyear$YearPPR)
countyyearlyaverage <- widedf %>% mutate(Year = format(Date, "%Y")) %>% filter(widedf$Region != "0 Hele landet" & widedf$PPR != 0) %>% group_by(Region, Year) %>% summarize(YearPPR = sum(PPR), difference = YearPPR - countryyear) 
maxydif <- countyyearlyaverage %>% ungroup() %>% filter(countyyearlyaverage$difference == max(countyyearlyaverage$difference))
minydif <- countyyearlyaverage %>% ungroup() %>% filter(countyyearlyaverage$difference == min(countyyearlyaverage$difference))
```

<p>On a yearly basis, the county that has the <b>highest positive difference is `r maxydif$Region`</b>, which corresponds to the <b>year `r maxydif$Year`</b>.
The county with the <b>highest negative difference is `r minydif$Region`</b> for the <b>year `r minydif$Year`</b>.</p>
</fieldset></form><br>
<form><fieldset><h2>Monthly price difference for Troms County (1999 - Now)</h2><br>
<p>However, the price difference is not a fixed number. It also evolves throughout the years. It can help us identify the evolution of the average room price from a county compared to the national average room price.</p>
<center>
```{r}
#Make a plot of the monthly price difference for Troms county from 1999 until today.
widedf %>% filter(widedf$Region == "19 Troms - Romsa" & Date >= "1999-01-01") %>% mutate(difference = PPR - meanCountry) %>% ggplot(., aes(x=Date, y=difference)) + ylab("Monthly Price Difference") + ggtitle("Monthly price difference for Troms county since 1999") + geom_line(color="#00A1FF")
```
</center><p>For the Troms County, we can see that the room price started <b>below the national average room price in 1999</b> but has <b>risen up since 2007</b> and now costs up to <b>approximately 200 kr more</b> than the national average room price.</p>
</fieldset></form><br>
<form><fieldset><h2>Making a link between room capacity, bed capacity and price (2010 - Now)</h2><br>
<p>Since the room price seems to have gone up in certain regions, could it be linked to the fact that rooms have gotten bigger, or that there are more beds in the rooms ?</p><center>
```{r}
#Per county, is there any relationship (correlation) between room capacity and price since January 2010?
#install.packages("DataExplorer")
widedf %>% filter(widedf$Region != "0 Hele landet" & Date >= "2010-01-01") -> relationship
plot_correlation(relationship, type = 'continuous', title="Is there a link between Room Capacity and Price ?")
```
</center><p>We can see that the Room Capacity seems to be <b>positively related</b> to the Price Per Room, which means that the bigger the room capacity is, the more costly it is. The Bed Capacity also seems to be positively linked to the other two.</p>
</fieldset></form><br>
</body>